<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VvE Verduurzamings Tool 2025</title>
    
    <!-- React & ReactDOM (via CDN) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (om JSX te vertalen in de browser) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS (via CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons (via CDN) -->
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        // Simpele Icon component wrapper omdat we geen imports hebben
        const Icon = ({ name, className }) => {
            React.useEffect(() => {
                lucide.createIcons();
            }, [name]);
            return <i data-lucide={name} className={className}></i>;
        };

        const App = () => {
            // --- Constants based on Research Report 2025 ---
            const DATA = {
                glass: {
                    none: { label: 'Geen wijziging', cost: 0, sub: 0, savings: 0 },
                    hr: { label: 'HR++ Glas (in best. kozijn)', cost: 140, sub: 50, savings: 15 },
                    triple: { label: 'Triple Glas + Nieuw Kozijn', cost: 850, sub: 222, savings: 35 }
                },
                roof: {
                    none: { label: 'Geen wijziging', cost: 0, sub: 0, savings: 0 },
                    base: { label: 'Dakisolatie (Rc ≥ 3.5)', cost: 65, sub: 32.50, savings: 10 }
                },
                facade: {
                    none: { label: 'Geen wijziging', cost: 0, sub: 0, savings: 0 },
                    spouw: { label: 'Spouwmuurisolatie', cost: 23, sub: 5.85, savings: 8 },
                    outer: { label: 'Buitengevelisolatie', cost: 175, sub: 40.50, savings: 25 }
                }
            };

            // Estimation Averages per Apartment
            const EST_GLASS_M2 = 12;  
            const EST_ROOF_M2 = 25;   
            const EST_FACADE_M2 = 35; 

            const INTEREST_RATE = 0.0369;
            const LOAN_DURATION = 20;
            const GAS_PRICE = 1.35;
            const BTW = 1.21;
            const MUNICIPAL_SUBSIDY_PER_APT = 1000;

            // --- State ---
            const [inputs, setInputs] = React.useState({
                apartments: 12,
                sqmGlass: 12 * 12, 
                sqmRoof: 12 * 25,
                sqmFacade: 12 * 35,
                currentServiceCosts: 150,
                maintenanceBudget: 20000,
                costDMJOP: 3500, 
                costAdvice: 2500, 
                builtBefore1995: true,
                twoPoorPartsPresent: true, 
                wozEligibleApartments: 12
            });

            const [choices, setChoices] = React.useState({
                glass: 'hr',
                roof: 'base',
                facade: 'spouw'
            });

            const [results, setResults] = React.useState(null);

            // --- Calculation Logic ---
            React.useEffect(() => {
                const costGlass = inputs.sqmGlass * DATA.glass[choices.glass].cost * BTW;
                const costRoof = inputs.sqmRoof * DATA.roof[choices.roof].cost * BTW;
                const costFacade = inputs.sqmFacade * DATA.facade[choices.facade].cost * BTW;
                
                const totalAdviceCosts = (inputs.costDMJOP + inputs.costAdvice) * BTW;
                const unforeseen = (costGlass + costRoof + costFacade) * 0.05;
                const totalGrossInvest = costGlass + costRoof + costFacade + unforeseen + totalAdviceCosts;

                const subGlass = inputs.sqmGlass * DATA.glass[choices.glass].sub;
                const subRoof = inputs.sqmRoof * DATA.roof[choices.roof].sub;
                const subFacade = inputs.sqmFacade * DATA.facade[choices.facade].sub;
                const svveSubsidy = subGlass + subRoof + subFacade;

                let activeMeasuresCount = 0;
                if (choices.glass !== 'none') activeMeasuresCount++;
                if (choices.roof !== 'none') activeMeasuresCount++;
                if (choices.facade !== 'none') activeMeasuresCount++;

                const isEligibleForMunicipal = inputs.builtBefore1995 && inputs.twoPoorPartsPresent && activeMeasuresCount >= 1;
                const municipalSubsidy = isEligibleForMunicipal ? (inputs.wozEligibleApartments * MUNICIPAL_SUBSIDY_PER_APT) : 0;

                const totalSubsidy = svveSubsidy + municipalSubsidy;
                const netInvestment = totalGrossInvest - totalSubsidy - inputs.maintenanceBudget;
                
                const monthlyRate = INTEREST_RATE / 12;
                const numPayments = LOAN_DURATION * 12;
                const annuityFactor = (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / (Math.pow(1 + monthlyRate, numPayments) - 1);
                const monthlyLoanCostTotal = netInvestment > 0 ? netInvestment * annuityFactor : 0;
                const monthlyLoanCostPerApp = monthlyLoanCostTotal / inputs.apartments;

                const totalSavingsM3 = (
                    (inputs.sqmGlass * DATA.glass[choices.glass].savings) +
                    (inputs.sqmRoof * DATA.roof[choices.roof].savings) +
                    (inputs.sqmFacade * DATA.facade[choices.facade].savings)
                );
                const totalSavingEuro = totalSavingsM3 * GAS_PRICE;
                const monthlySavingPerApp = totalSavingEuro / 12 / inputs.apartments;

                setResults({
                    investGross: totalGrossInvest,
                    investConstruction: costGlass + costRoof + costFacade,
                    investAdvice: totalAdviceCosts,
                    svveSubsidy,
                    municipalSubsidy,
                    totalSubsidy,
                    investNet: netInvestment,
                    loanMonthly: monthlyLoanCostPerApp,
                    energySavingMonthly: monthlySavingPerApp,
                    netMonthlyEffect: monthlyLoanCostPerApp - monthlySavingPerApp,
                    measureCount: activeMeasuresCount
                });
            }, [inputs, choices]);

            const handleInputChange = (e) => {
                const { name, value, type, checked } = e.target;
                const numericValue = parseFloat(value) || 0;

                if (name === 'apartments') {
                    setInputs(prev => ({ 
                        ...prev, 
                        [name]: numericValue,
                        sqmGlass: numericValue * EST_GLASS_M2,
                        sqmRoof: numericValue * EST_ROOF_M2,
                        sqmFacade: numericValue * EST_FACADE_M2,
                        wozEligibleApartments: numericValue 
                    }));
                } else {
                    setInputs(prev => ({ 
                        ...prev, 
                        [name]: type === 'checkbox' ? checked : numericValue 
                    }));
                }
            };

            const handleChoiceChange = (category, value) => {
                setChoices(prev => ({ ...prev, [category]: value }));
            };

            const exportToCSV = () => {
                if (!results) return;

                const csvContent = [
                    ["VvE Verduurzamings Rapportage 2025", ""],
                    ["", ""],
                    ["--- INPUT GEGEVENS ---", ""],
                    ["Aantal Appartementen", inputs.apartments],
                    ["Advieskosten DMJOP (ex BTW)", inputs.costDMJOP],
                    ["Procesbegeleiding (ex BTW)", inputs.costAdvice],
                    ["Bouwjaar voor 1995", inputs.builtBefore1995 ? "Ja" : "Nee"],
                    ["2 Slechte delen aanwezig", inputs.twoPoorPartsPresent ? "Ja" : "Nee"],
                    ["Aantal woningen WOZ < 486k", inputs.wozEligibleApartments],
                    ["", ""],
                    ["--- FINANCIEEL OVERZICHT ---", ""],
                    ["Bouwkundige Kosten (incl BTW)", results.investConstruction.toFixed(2)],
                    ["Advies & DMJOP (incl BTW)", results.investAdvice.toFixed(2)],
                    ["Bruto Investering Totaal", results.investGross.toFixed(2)],
                    ["Landelijke SVVE Subsidie", results.svveSubsidy.toFixed(2)],
                    ["Gemeentelijke Subsidie", results.municipalSubsidy.toFixed(2)],
                    ["Netto Financieringsbehoefte", results.investNet.toFixed(2)],
                    ["", ""],
                    ["--- MAANDLASTEN PER APPARTEMENT ---", ""],
                    ["Netto effect", results.netMonthlyEffect.toFixed(2)]
                ].map(e => e.join(",")).join("\n");

                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", "VvE_Verduurzaming_Detail.csv");
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const formatCurrency = (val) => {
                return new Intl.NumberFormat('nl-NL', { style: 'currency', currency: 'EUR' }).format(val);
            };

            return (
                <div className="min-h-screen p-4 md:p-8 font-sans relative">
                    <div className="max-w-6xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden">
                        
                        {/* Header */}
                        <div className="bg-blue-900 text-white p-6 flex flex-col md:flex-row justify-between items-center gap-4">
                            <div>
                                <h1 className="text-2xl font-bold flex items-center gap-2">
                                    <Icon name="calculator" className="w-8 h-8" />
                                    VvE Verduurzamings Tool 2025
                                </h1>
                                <p className="text-blue-200 mt-1">Inclusief DMJOP, Advieskosten & Lokale Subsidies</p>
                            </div>
                            <button 
                                onClick={exportToCSV}
                                className="bg-blue-800 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors border border-blue-700"
                            >
                                <Icon name="download" className="w-4 h-4" />
                                <span className="ml-2">Excel Export</span>
                            </button>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-0">
                            
                            {/* LEFT COLUMN: INPUTS */}
                            <div className="lg:col-span-5 p-6 border-r border-gray-200 bg-gray-50 space-y-8">
                                
                                {/* Gebouw Data */}
                                <section>
                                    <h2 className="text-lg font-semibold text-gray-800 flex items-center gap-2 mb-4">
                                        <Icon name="home" className="w-5 h-5 text-blue-600" />
                                        Gebouw & Oppervlakten
                                    </h2>
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">Aantal Appartementen</label>
                                            <input 
                                                type="number" 
                                                name="apartments" 
                                                value={inputs.apartments} 
                                                onChange={handleInputChange} 
                                                className="mt-1 block w-full rounded-md border-blue-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 border p-2 bg-blue-50" 
                                            />
                                            <p className="text-xs text-gray-500 mt-1">Wijzigen van aantal berekent automatisch nieuwe m² schattingen.</p>
                                        </div>

                                        <div className="grid grid-cols-3 gap-3">
                                            <div>
                                                <label className="block text-xs font-medium text-gray-700">Glas (m²)</label>
                                                <input type="number" name="sqmGlass" value={inputs.sqmGlass} onChange={handleInputChange} className="mt-1 block w-full rounded-md border-gray-300 border p-2 text-sm" />
                                            </div>
                                            <div>
                                                <label className="block text-xs font-medium text-gray-700">Dak (m²)</label>
                                                <input type="number" name="sqmRoof" value={inputs.sqmRoof} onChange={handleInputChange} className="mt-1 block w-full rounded-md border-gray-300 border p-2 text-sm" />
                                            </div>
                                            <div>
                                                <label className="block text-xs font-medium text-gray-700">Gevel (m²)</label>
                                                <input type="number" name="sqmFacade" value={inputs.sqmFacade} onChange={handleInputChange} className="mt-1 block w-full rounded-md border-gray-300 border p-2 text-sm" />
                                            </div>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">MJOP Spaarpot Inzet (€)</label>
                                            <input type="number" name="maintenanceBudget" value={inputs.maintenanceBudget} onChange={handleInputChange} className="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 border p-2" />
                                        </div>
                                    </div>
                                </section>

                                {/* Advies & Organisatie Kosten */}
                                <section className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                    <h2 className="text-lg font-semibold text-gray-800 flex items-center gap-2 mb-3">
                                        <Icon name="file-text" className="w-5 h-5 text-gray-600" />
                                        Advies & Organisatie
                                    </h2>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-xs font-medium text-gray-700">DMJOP Kosten (ex)</label>
                                            <input type="number" name="costDMJOP" value={inputs.costDMJOP} onChange={handleInputChange} className="mt-1 block w-full rounded-md border-gray-300 border p-2 text-sm" />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-medium text-gray-700">Procesbegeleiding (ex)</label>
                                            <input type="number" name="costAdvice" value={inputs.costAdvice} onChange={handleInputChange} className="mt-1 block w-full rounded-md border-gray-300 border p-2 text-sm" />
                                        </div>
                                    </div>
                                    <p className="text-xs text-gray-500 mt-2">Prijzen exclusief BTW. Tool berekent 21% BTW erbij.</p>
                                </section>

                                {/* Gemeentelijke Subsidie */}
                                <section className="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                                    <h2 className="text-lg font-semibold text-yellow-800 flex items-center gap-2 mb-2">
                                        <Icon name="building-2" className="w-5 h-5" />
                                        Gemeentelijke Subsidie
                                    </h2>
                                    <p className="text-xs text-yellow-700 mb-3">€1.000 per appartement mits WOZ &lt; €486k, bouwjaar &lt; 1995 en minstens 1 maatregel.</p>
                                    
                                    <div className="space-y-2">
                                        <div className="flex items-center gap-3">
                                            <input type="checkbox" name="builtBefore1995" checked={inputs.builtBefore1995} onChange={handleInputChange} id="builtBefore" className="h-4 w-4 text-blue-600 rounded" />
                                            <label htmlFor="builtBefore" className="text-sm text-gray-700">Bouwjaar vóór 1995</label>
                                        </div>

                                        <div className="flex items-center gap-3">
                                            <input type="checkbox" name="twoPoorPartsPresent" checked={inputs.twoPoorPartsPresent} onChange={handleInputChange} id="twoPoorParts" className="h-4 w-4 text-blue-600 rounded" />
                                            <label htmlFor="twoPoorParts" className="text-sm text-gray-700">Heeft gebouw 2 slechte delen?</label>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mt-2">Aantal woningen WOZ &lt; €486.000</label>
                                            <input type="number" name="wozEligibleApartments" value={inputs.wozEligibleApartments} onChange={handleInputChange} max={inputs.apartments} className="mt-1 block w-full rounded-md border-gray-300 border p-2" />
                                        </div>
                                    </div>
                                </section>

                                {/* Maatregelen */}
                                <section>
                                    <h2 className="text-lg font-semibold text-gray-800 flex items-center gap-2 mb-4">
                                        <Icon name="tree-deciduous" className="w-5 h-5 text-green-600" />
                                        Maatregelen Selectie
                                    </h2>
                                    <div className="space-y-3">
                                        <div className="space-y-1">
                                            <select value={choices.glass} onChange={(e) => handleChoiceChange('glass', e.target.value)} className="block w-full rounded-md border-gray-300 p-2 border text-sm">
                                                {Object.entries(DATA.glass).map(([key, item]) => <option key={key} value={key}>Glas: {item.label}</option>)}
                                            </select>
                                        </div>
                                        <div className="space-y-1">
                                            <select value={choices.roof} onChange={(e) => handleChoiceChange('roof', e.target.value)} className="block w-full rounded-md border-gray-300 p-2 border text-sm">
                                                {Object.entries(DATA.roof).map(([key, item]) => <option key={key} value={key}>Dak: {item.label}</option>)}
                                            </select>
                                        </div>
                                        <div className="space-y-1">
                                            <select value={choices.facade} onChange={(e) => handleChoiceChange('facade', e.target.value)} className="block w-full rounded-md border-gray-300 p-2 border text-sm">
                                                {Object.entries(DATA.facade).map(([key, item]) => <option key={key} value={key}>Gevel: {item.label}</option>)}
                                            </select>
                                        </div>
                                    </div>
                                </section>
                            </div>

                            {/* RIGHT COLUMN: RESULTS */}
                            <div className="lg:col-span-7 p-6 space-y-6">
                                
                                {/* Top Cards */}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div className="bg-blue-50 p-4 rounded-xl border border-blue-100">
                                        <div className="text-sm text-blue-600 font-medium mb-1">Totale Bruto Investering</div>
                                        <div className="text-xl font-bold text-gray-900">{results ? formatCurrency(results.investGross) : '-'}</div>
                                        <div className="text-xs text-gray-500 mt-1">Incl. Advies, DMJOP, 5% onvoorzien & BTW</div>
                                    </div>
                                    
                                    <div className="bg-orange-50 p-4 rounded-xl border border-orange-100">
                                        <div className="text-sm text-orange-600 font-medium mb-1">Netto Te Financieren</div>
                                        <div className="text-xl font-bold text-gray-900">{results ? formatCurrency(results.investNet) : '-'}</div>
                                        <div className="text-xs text-gray-500 mt-1">Na subsidies & MJOP inzet</div>
                                    </div>
                                </div>

                                {/* Subsidy Breakdown */}
                                <div className="bg-green-50 p-4 rounded-xl border border-green-100">
                                    <div className="flex justify-between items-center mb-2">
                                        <div className="text-sm text-green-800 font-bold">Totale Subsidies</div>
                                        <div className="text-lg font-bold text-green-700">{results ? formatCurrency(results.totalSubsidy) : '-'}</div>
                                    </div>
                                    
                                    <div className="space-y-1 text-sm text-green-700">
                                        <div className="flex justify-between">
                                            <span>Landelijke SVVE Subsidie:</span>
                                            <span>{results ? formatCurrency(results.svveSubsidy) : '-'}</span>
                                        </div>
                                        <div className="flex justify-between font-medium">
                                            <span>Gemeentelijke Subsidie (WOZ):</span>
                                            <span>{results ? formatCurrency(results.municipalSubsidy) : '-'}</span>
                                        </div>
                                    </div>
                                </div>

                                {/* Cost Breakdown Details */}
                                {results && (
                                    <div className="bg-gray-50 p-3 rounded-lg text-sm text-gray-600 border border-gray-200">
                                        <div className="flex justify-between">
                                            <span>Bouwkundige kosten (incl BTW):</span>
                                            <span>{formatCurrency(results.investConstruction)}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span>Advies & DMJOP (incl BTW):</span>
                                            <span>{formatCurrency(results.investAdvice)}</span>
                                        </div>
                                    </div>
                                )}

                                {/* Main Result: Woonlasten */}
                                <div className="bg-white border rounded-xl shadow-sm p-6">
                                    <h2 className="text-xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                                        <Icon name="euro" className="w-6 h-6 text-gray-700" />
                                        Effect Woonlasten (per maand)
                                    </h2>

                                    <div className="space-y-4">
                                        <div className="flex justify-between items-center p-3 bg-red-50 rounded-lg">
                                            <div className="flex items-center gap-3">
                                                <div className="w-8 h-8 rounded-full bg-red-200 flex items-center justify-center text-red-700 font-bold">-</div>
                                                <div>
                                                    <div className="font-semibold text-gray-800">Lening Warmtefonds</div>
                                                    <div className="text-xs text-gray-500">3,69% rente, 20 jaar looptijd</div>
                                                </div>
                                            </div>
                                            <div className="font-bold text-red-600 text-lg">
                                                + {results ? formatCurrency(results.loanMonthly) : '-'}
                                            </div>
                                        </div>

                                        <div className="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                                            <div className="flex items-center gap-3">
                                                <div className="w-8 h-8 rounded-full bg-green-200 flex items-center justify-center text-green-700 font-bold">+</div>
                                                <div>
                                                    <div className="font-semibold text-gray-800">Energiebesparing (indicatief)</div>
                                                    <div className="text-xs text-gray-500">Minder gasverbruik</div>
                                                </div>
                                            </div>
                                            <div className="font-bold text-green-600 text-lg">
                                                - {results ? formatCurrency(results.energySavingMonthly) : '-'}
                                            </div>
                                        </div>

                                        <div className="border-t border-gray-200 my-4"></div>

                                        <div className="flex justify-between items-center px-3">
                                            <div className="font-bold text-gray-900 text-lg">Netto effect servicekosten</div>
                                            <div className={`font-bold text-2xl ${results?.netMonthlyEffect > 0 ? 'text-orange-600' : 'text-green-600'}`}>
                                                {results ? (results.netMonthlyEffect > 0 ? `+ ${formatCurrency(results.netMonthlyEffect)}` : formatCurrency(results.netMonthlyEffect)) : '-'}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-blue-50 p-4 rounded-lg flex gap-3 text-sm text-blue-800">
                                    <Icon name="info" className="w-5 h-5 flex-shrink-0 mt-0.5" />
                                    <div>
                                        <strong>Disclaimer:</strong>
                                        <p className="mt-1 mb-2">
                                            Deze rekentool is uitsluitend bedoeld ter indicatie en inspiratie. Aan de uitkomsten kunnen geen rechten worden ontleend. 
                                            Raadpleeg voor investeringsbeslissingen altijd een financieel adviseur.
                                        </p>
                                        <p className="text-xs text-blue-600/80 border-t border-blue-200 pt-2 mt-2">
                                            Let op: De gemeentelijke subsidie vereist dat er in het gebouw minstens 2 'slechte' bouwdelen aanwezig zijn, en dat u er minstens 1 verbetert.
                                        </p>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
